<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">

	<title>Title Goes Here</title>
    <style>
        canvas {
            border: 1px solid;
        }
    </style>
</head>

<body>
<canvas id="myCanvas" width="800" height="400"></canvas>
<script type="text/javascript">
(function() {

    console.log('start');
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    var GRAVITY = 9.8;


    var get_mom_inertia = function(wheel) {
        return wheel.first_mass * wheel.radius * wheel.radius;
    }

    var draw_circle = function(x, y, r) {
        ctx.beginPath();
        ctx.arc(x, y, r,0,2*Math.PI);
        ctx.stroke();
    };

    var draw_wheel = function(wheel) {
        ctx.beginPath();
        ctx.moveTo(wheel.x, wheel.y);
        var x2 = wheel.x + wheel.radius * Math.cos(wheel.theta);
        var y2 = wheel.y + wheel.radius * Math.sin(wheel.theta);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        draw_circle(x2, y2, 5);

        draw_circle(wheel.x, wheel.y, wheel.radius);
    };

    var get_wheel_angular_acceleration = function(wheel, mom_inertia) {
        // due to mass
        var force = wheel.first_mass * GRAVITY;
        var t1 = force * wheel.radius * Math.cos(wheel.theta);

        // due to ramp
        var ramp_force = 1; // TODO do something here
        var t2 = 8;
        // var t2 = ramp_force * wheel.radius * Math.cos(-3.0/4 * Math.PI);
        return (t1 + t2) / mom_inertia;
    }

    var clear_canvas = function() {
        ctx.clearRect (0, 0, 800, 400);
    };

    var first_wheel = {
        x: 100,
        y: 100,
        theta: 0, // radians
        radius: 30,
        angular_vel: 0,
        first_mass: .1, // TODO get more general?
        total_mass: .1,
        mom_inertia: 0
    };
    first_wheel.mom_inertia = get_mom_inertia(first_wheel);

    var FRAME_TIME_DELTA = .03; // in s
    var ramp_angle = Math.PI / 8.0; // lower is flatter

    var next_frame = function() {
        var alpha = get_wheel_angular_acceleration(first_wheel, 1);
        first_wheel.angular_vel = first_wheel.angular_vel + alpha * FRAME_TIME_DELTA;
        var theta_change = first_wheel.angular_vel * FRAME_TIME_DELTA;
        first_wheel.theta = first_wheel.theta + theta_change;

        first_wheel.x = first_wheel.x + (first_wheel.radius * theta_change) * Math.cos(ramp_angle);
        first_wheel.y = first_wheel.y + (first_wheel.radius * theta_change) * Math.sin(ramp_angle);

        clear_canvas();
        draw_wheel(first_wheel);
    }

    setInterval(next_frame, FRAME_TIME_DELTA * 1000); // just for now
})();
</script>
</body>
</html>


